## 2026-02-18 22:46:49

### 实现目标
- 修复 Desktop 版 IPA 页面点击音标/单词无响应的问题。
- 抽离主要界面文案到语言资源文件，建立 i18n 基础能力。

### 变更内容
- 修复 `Views/IpaChartView.axaml` 中列表项按钮命令绑定：改为通过根节点 `#Root.DataContext` 访问 `SelectPhonemeCommand` 与 `PlayWordCommand`，避免模板内父级路径绑定失效。
- 新增 `Services/LocalizationService.cs`，提供基于 `resx` 的语言资源读取、文化设置与绑定刷新能力。
- 新增资源文件：`Resources/Strings.resx`、`Resources/Strings.zh-CN.resx`。
- 在 `App.axaml` 中注册全局本地化资源 `Loc`。
- 将 `MainView.axaml`、`IpaChartView.axaml`、`SettingsView.axaml` 的主要英文文案替换为 `Loc` 资源绑定。

### 验证结果（可选）
- 待执行构建验证与运行交互验证。

### 后续计划（可选）
- 将 `ExamView`、`FavoritesView`、`ExamHistoryView` 等剩余硬编码文案继续迁移到 i18n 资源。
- 增加设置页语言切换并持久化（建议通过数据库迁移或独立配置存储实现）。

## 2026-02-18 22:49:30

### 实现目标
- 完成本次改动后的构建验证与风险回归确认。

### 验证结果（可选）
- 执行 `dotnet build PhonoArk/PhonoArk.sln`：构建成功（0 Error）。
- 仍保留 `PhonoArk.Browser` 的既有 WASM NativeFileReference 警告（不影响 Desktop 体验测试）。

## 2026-02-18 23:08:04

### 实现目标
- 完成 `Exam/Favorites/ExamHistory` 三页 i18n 迁移。
- 在设置页增加语言切换并实现持久化。

### 变更内容
- 扩展 `LocalizationService`：新增 `GetString/Format`，并将语言设置持久化到 `LocalApplicationData/PhonoArk/language.txt`。
- `SettingsViewModel` 增加语言选项与当前语言绑定，选择语言时即时生效并持久化。
- `SettingsView` 增加语言选择 UI。
- `ExamView`、`FavoritesView`、`ExamHistoryView` 全面改为资源键绑定（`Loc`），移除大部分硬编码英文文案。
- `ExamViewModel` 的运行时反馈文案（正确/错误/无题可用/考试完成）改为 i18n 资源格式化输出。
- 补全 `Resources/Strings.resx` 与 `Resources/Strings.zh-CN.resx` 的新键值翻译。

### 验证结果（可选）
- 执行 `dotnet build PhonoArk/PhonoArk.sln`：构建成功（0 Error）。
- Browser 项目仍有既有 WASM 警告，未新增与本次改动相关的编译错误。

## 2026-02-18 23:21:20

### 实现目标
- 修复设置页“默认口音”无法选择（`InvalidCastException`）问题。
- 让音标/单词按钮在 Desktop 上至少产生可听反馈音。

### 变更内容
- `SettingsViewModel` 新增强类型 `AccentOption` 与 `AccentOptions/SelectedAccentOption`，避免 `ComboBoxItem -> Accent` 的类型转换错误。
- `SettingsView` 的默认口音下拉改为 `ItemsSource` 绑定 `AccentOptions`，通过 `DisplayName` 展示。
- `AudioService` 改造为可听反馈：在未接入真实音频文件播放时，按音标/单词生成回退蜂鸣音（Windows）。
- 为回退蜂鸣音增加跨平台保护与分析器处理，避免构建失败。

### 验证结果（可选）
- 执行 `dotnet build PhonoArk/PhonoArk.sln`：构建成功（0 Error）。
- 当前仅保留既有 Browser WASM 警告，与本次修复无关。

## 2026-02-18 23:35:25

### 实现目标
- 为 Windows Desktop 接入可用的系统 TTS，实现音标/单词点击后正常语音输出。

### 变更内容
- `AudioService` 增加 Windows TTS 播放链路：通过反射调用 `System.Speech.Synthesis.SpeechSynthesizer`，避免对非 Windows 目标产生编译耦合。
- 增加按口音选择语音文化（`GenAm -> en-US`，`RP -> en-GB`）的逻辑。
- 音标播放优先使用示例单词进行 TTS（可听性更高），单词播放直接朗读单词文本。
- 当 TTS 不可用时自动回退到原有提示音兜底，保证交互有反馈。

### 验证结果（可选）
- 执行 `dotnet build PhonoArk/PhonoArk.sln`：构建成功（0 Error）。
- Browser 项目仍有既有 WASM 警告，未新增与本次改动相关错误。

## 2026-02-18 23:43:31

### 实现目标
- 修复 Windows Debug 桌面环境下语音仍回退蜂鸣的问题，提升 TTS 命中率。

### 变更内容
- 在 `AudioService` 中新增 Windows 二级兜底：当直接反射 `System.Speech` 失败时，自动调用 `pwsh/powershell` 执行系统 TTS 脚本朗读。
- 脚本中同步应用当前口音（`en-US/en-GB`）与音量百分比。
- 保留最终蜂鸣兜底，仅在两级 TTS 均失败时触发。

### 验证结果（可选）
- 执行 `dotnet build PhonoArk/PhonoArk.sln`：构建成功（0 Error）。
- Browser 项目仍有既有 WASM 警告，与本次修复无关。

## 2026-02-18 23:53:50

### 实现目标
- 按根因修复 Windows Debug 下 TTS 回退蜂鸣问题，不再使用 PowerShell 兜底。

### 变更内容
- 移除 `AudioService` 中的 PowerShell TTS 兜底实现。
- 根因修复：将 `System.Speech` 调用从线程池线程改为专用 STA 线程执行（`RunOnStaThreadAsync`），避免线程模型不匹配导致语音合成失败。
- 保留最后一级蜂鸣兜底，仅在系统 TTS 仍失败时触发。

### 验证结果（可选）
- 执行 `dotnet build PhonoArk/PhonoArk.sln`：构建成功（0 Error）。
- 仅保留既有 Browser WASM 警告，未引入新错误。

## 2026-02-19 07:56:33

### 实现目标
- 在 `newapp` 目录下创建全新的 Android 版音律方舟应用，完全重写，不参考已有设计。
- 采用 .NET MAUI + MVVM 架构，适配 Android 原生交互习惯。
- 实现音标学习与音标考试两大核心功能。

### 变更内容
- 新增架构文档 `newapp/docs/architecture.md`，描述分层设计、模型、服务、ViewModel 与页面导航。
- 新增 `PhonoArk.Mobile.Core` 类库（net10.0）：
  - Models：`Phoneme`、`ExampleWord`、`PhonemeCategory`、`ExamQuestion`、`ExamQuestionType`、`ExamResult`、`AnswerRecord`。
  - Services：`IPhonemeService` / `PhonemeService`（44 个音标，每个配 5 个示例单词含音标标注）；`IExamService` / `ExamService`（出题、判题、计分）。
  - ViewModels：`BaseViewModel`、`HomeViewModel`、`PhonemeListViewModel`、`PhonemeDetailViewModel`、`ExamViewModel`、`ExamResultViewModel`。
- 新增 `PhonoArk.Mobile.App` MAUI Android 项目（net10.0-android）：
  - Pages：`HomePage`（首页卡片导航）、`PhonemeListPage`（分类 Tab + 网格浏览）、`PhonemeDetailPage`（大字音标 + 单词列表可点击发音）、`ExamPage`（4 选项 + 进度条 + 实时反馈）、`ExamResultPage`（得分 + 错题回顾）。
  - `App.xaml` 定义全局配色与样式；`AppShell.xaml` 定义导航路由。
  - 集成系统 TTS 实现单词点击朗读。
- 新增 `PhonoArk.Mobile.Tests` xUnit 测试项目（net10.0），共 89 个测试用例：
  - `PhonemeServiceTests`（16 个）：数据完整性、分类过滤、符号查找。
  - `ExamServiceTests`（21 个）：出题逻辑、判题、计分、边界条件。
  - `HomeViewModelTests`（4 个）：导航事件。
  - `PhonemeListViewModelTests`（8 个）：类别切换、属性通知。
  - `PhonemeDetailViewModelTests`（7 个）：属性、发音请求。
  - `ExamViewModelTests`（16 个）：考试流程、状态管理、完成事件。
  - `ExamResultViewModelTests`（7+6 Theory = 13 个）：得分计算、评语。

### 验证结果
- `dotnet build PhonoArk.Mobile.Core`：构建成功（0 Error，0 Warning）。
- `dotnet test PhonoArk.Mobile.Tests`：89 个测试全部通过。

### 后续计划（可选）
- 安装 MAUI/Android 工作负载后即可编译运行 `PhonoArk.Mobile.App`。
- 可扩展：收藏功能、考试历史记录、音频文件播放（替代 TTS）。
