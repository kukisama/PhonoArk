<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:PhonoArk.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="PhonoArk.Views.ExamView"
             x:Name="Root"
             x:CompileBindings="False"
             x:DataType="vm:ExamViewModel">

  <Grid Margin="20">
    <!-- Exam Setup -->
    <StackPanel IsVisible="{Binding !IsExamActive}" 
                VerticalAlignment="Center" 
                HorizontalAlignment="Center"
                Spacing="20"
                MaxWidth="400">
      <TextBlock Text="{Binding [PracticeExam], Source={StaticResource Loc}}" 
                 FontSize="28" 
                 FontWeight="Bold"
                 HorizontalAlignment="Center"/>

      <StackPanel Spacing="10">
        <TextBlock Text="{Binding [NumberOfQuestions], Source={StaticResource Loc}}" FontSize="16"/>
        <NumericUpDown Value="{Binding QuestionCount}"
                      Minimum="5"
                      Maximum="50"
                      Increment="5"/>
      </StackPanel>

      <StackPanel Spacing="10">
        <TextBlock Text="{Binding [ExamScope], Source={StaticResource Loc}}" FontSize="16"/>
        <ComboBox SelectedItem="{Binding ExamScope}" HorizontalAlignment="Stretch">
          <ComboBoxItem Content="{Binding [AllPhonemes], Source={StaticResource Loc}}" Tag="All"/>
          <ComboBoxItem Content="{Binding [FavoritesOnly], Source={StaticResource Loc}}" Tag="Favorites"/>
        </ComboBox>
      </StackPanel>

      <Button Content="{Binding [StartExam], Source={StaticResource Loc}}"
              Command="{Binding StartExamCommand}"
              HorizontalAlignment="Stretch"
              Padding="15"
              FontSize="18"/>
    </StackPanel>

    <!-- Exam Active -->
    <Grid IsVisible="{Binding IsExamActive}" RowDefinitions="Auto,*,Auto">
      <!-- Progress Header -->
      <Border Grid.Row="0" 
              Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
              Padding="15"
              Margin="0,0,0,10">
        <Grid ColumnDefinitions="*,Auto">
          <StackPanel Grid.Column="0">
            <StackPanel Orientation="Horizontal" Spacing="4">
              <TextBlock Text="{Binding [QuestionLabel], Source={StaticResource Loc}}"
                         FontSize="18"
                         FontWeight="SemiBold"/>
              <TextBlock Text="{Binding CurrentQuestionIndex}"
                         FontSize="18"
                         FontWeight="SemiBold"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="4">
              <TextBlock Text="{Binding [OfLabel], Source={StaticResource Loc}}"
                         FontSize="14"
                         Opacity="0.7"/>
              <TextBlock Text="{Binding TotalQuestions}"
                         FontSize="14"
                         Opacity="0.7"/>
            </StackPanel>
          </StackPanel>
          <StackPanel Grid.Column="1" HorizontalAlignment="Right">
            <StackPanel Orientation="Horizontal" Spacing="4">
              <TextBlock Text="{Binding [CorrectLabel], Source={StaticResource Loc}}"
                         FontSize="16"
                         FontWeight="SemiBold"/>
              <TextBlock Text="{Binding CorrectAnswers}"
                         FontSize="16"
                         FontWeight="SemiBold"/>
            </StackPanel>
          </StackPanel>
        </Grid>
      </Border>

      <!-- Question Content -->
      <StackPanel Grid.Row="1" 
                  VerticalAlignment="Center" 
                  Spacing="20"
                  MaxWidth="600">
        
        <TextBlock Text="{Binding [ListenAndSelectWord], Source={StaticResource Loc}}"
                   FontSize="18"
                   TextWrapping="Wrap"
                   HorizontalAlignment="Center"/>

        <Button Content="{Binding [PlayPhoneme], Source={StaticResource Loc}}"
                Command="{Binding PlayCurrentQuestionCommand}"
                HorizontalAlignment="Center"
                Padding="20,15"
                FontSize="20"/>

        <TextBlock Text="{Binding [SelectWord], Source={StaticResource Loc}}"
                   FontSize="16"
                   Margin="0,10,0,0"/>

        <!-- Answer Options -->
        <ItemsControl ItemsSource="{Binding CurrentQuestion.Options}">
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <Button Content="{Binding Word}"
                      Command="{Binding #Root.DataContext.SelectAnswerCommand}"
                      CommandParameter="{Binding}"
                      HorizontalAlignment="Stretch"
                      Margin="0,5"
                      Padding="15"
                      FontSize="18"/>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Feedback -->
        <Border IsVisible="{Binding ShowFeedback}"
                Background="{DynamicResource SystemControlBackgroundAccentBrush}"
                Padding="15"
                CornerRadius="8"
                Margin="0,10,0,0">
          <TextBlock Text="{Binding FeedbackMessage}"
                     FontSize="16"
                     TextWrapping="Wrap"
                     HorizontalAlignment="Center"/>
        </Border>
      </StackPanel>

      <!-- Control Buttons -->
      <StackPanel Grid.Row="2" 
                  Orientation="Horizontal" 
                  HorizontalAlignment="Center"
                  Spacing="10"
                  Margin="0,20,0,0">
        <Button Content="{Binding [NextQuestion], Source={StaticResource Loc}}"
                Command="{Binding NextQuestionCommand}"
                Padding="15,10"
                IsVisible="{Binding CurrentQuestion.IsAnswered}"/>
        <Button Content="{Binding [EndExam], Source={StaticResource Loc}}"
                Command="{Binding EndExamCommand}"
                Padding="15,10"/>
      </StackPanel>
    </Grid>
  </Grid>
</UserControl>
